- name: Check version for each tool in the group
  shell: "{{ item.command }} | head -n 1"  # Remove the sed part since it's done in the command
  register: tool_version_output
  failed_when: false
  changed_when: false
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: item.command is defined

- name: Debug the raw output of the shell command
  debug:
    msg: "Raw output for {{ item.name }}: {{ tool_version_output.stdout }}"
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: tool_version_output.stdout is defined

- name: Set version result
  set_fact:
    version_results: "{{ version_results | combine({group_name: (version_results[group_name] | default([])) + [{'name': item.name, 'version': tool_version_output.stdout}]}) }}"
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: tool_version_output.stdout is defined
