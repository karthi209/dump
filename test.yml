- name: Collect tool versions
  shell: "{{ item.command }}"
  register: tool_version_output
  failed_when: false
  changed_when: false
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: item.command is defined
  # Collect version results directly into version_results
  set_fact:
    version_results: "{{ version_results | default({}) | combine({group_name: (version_results[group_name] | default([])) + [{'name': item.name, 'version': tool_version_output.stdout}]}) }}"
  when: tool_version_output.stdout is defined

- name: Display tool versions
  debug:
    msg: "Tool versions for {{ group_name }}: {{ version_results[group_name] }}"
