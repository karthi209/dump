---
- name: Check version for each tool in the group
  shell: "{{ item.command }}"
  register: tool_version_output
  failed_when: false
  changed_when: false
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: item.command is defined

- name: Extract version using regex
  set_fact:
    version_results: "{{ version_results | combine({group_name: (version_results[group_name] | default([])) + [{'name': item.name, 'version': (tool_version_output.stdout | regex_search(item.regex))}]}) }}"
  loop: "{{ group_tools }}"
  loop_control:
    loop_var: item
  when: tool_version_output.stdout is defined
